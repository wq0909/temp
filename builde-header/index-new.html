<!DOCTYPE html>
<!--[if IE 7 ]><html class="no-js ie ie7 lte7 lte8 lte9" lang="en-US"> <![endif]-->
<!--[if IE 8 ]><html class="no-js ie ie8 lte8 lte9" lang="en-US"> <![endif]-->
<!--[if IE 9 ]><html class="no-js ie ie9 lte9>" lang="en-US"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html class="no-js" lang="en-US">
<!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>
		Download Builder | jQuery UI
	</title>
	<meta name="author" content="The jQuery Project - jQuery.org">
	<meta name="description" content="jQuery: The Write Less, Do More, JavaScript Library">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<link rel="pingback" href="http://jqueryui.com/xmlrpc.php" />
	<link rel="stylesheet" href="jquery-ui-1.9.2.custom.css">
	<link rel="stylesheet" href="download-new.css">
	<script>
		var headerConfig = null,
			layout = 'normal';
	</script>
</head>
<body class="jquery-ui page">
	<div id="header-view">
		<div class="header-view-fixed">
			<iframe src="header.html" id="header-view-iframe" frameborder="no" width="100%" height="131px"
			marginheight="0" marginwidth="0" scrolling="no">
			</iframe>
			<div class="header-view-ctrl">
				<button class="ui-button btn-builde">Builde</button>
				<button class="ui-button btn-cms-code">CMS代码</button>
				<button class="ui-button btn-vm-code">VM代码</button>
			</div>
		</div>
	</div>
	<div id="download-builder-content">
		<h1 class="entry-title">
			Header UI Builder
		</h1>
		<hr />
		<div id="download-builder">
			<form id="download-form" method="POST" action="#">
				<div class="download-builder-header layout-area">
					<h2>
						Layout
					</h2>
					<div class="field-pair">
						<label class="clearfix">
							<input type="radio" name="layout" value="full">
							<span class="layout-title">
								Full
							</span>
							<span class="layout-label">
								类似首页（搜索功能样式的差异）
							</span>
						</label>
					</div>
					<div class="field-pair">
						<label class="clearfix">
							<input type="radio" checked="checked" name="layout" value="normal">
							<span class="layout-title">
								Normal
							</span>
							<span class="layout-label">
								类似频道页面（推荐使用）
							</span>
						</label>
					</div>
				</div>
				<div class="download-builder-header">
					<h2>
						Components
					</h2>
					<label class="toggleAll"><input type="checkbox" class="ui-widget-content" checked="checked"> Toggle All</label>
				</div>
				<div class="components-area">
					<div class="ui-widget ui-widget-content component-group clearfix">
						<div class="component-group-desc">
							<h3>
								UI Core
							</h3>
						</div>
						<div class="component-group-list">
							<div class="clearfix">
								<input type="checkbox" data-dependencies="" class="ui-widget-content" name="core" id="core" checked="checked"/>
								<label class="clearfix" title="" for="core">
									<span class="component-title">
										Core
									</span>
									<span class="component-desc">
										核心.
									</span>
								</label>
							</div>
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core" class="ui-widget-content" name="sundry" id="sundry" checked="checked"/>
								<label class="clearfix" title="" for="sundry">
									<span class="component-title">
										Sundry
									</span>
									<span class="component-desc">
										杂项功能.
									</span>
								</label>
							</div>
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core" class="ui-widget-content" name="beacon" id="beacon" checked="checked"/>
								<label class="clearfix" title="" for="beacon">
									<span class="component-title">
										Beacon
									</span>
									<span class="component-desc">
										灯塔功能.
									</span>
								</label>
							</div>
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core" class="ui-widget-content" name="searchbar" id="searchbar" checked="checked"/>
								<label class="clearfix" title="" for="searchbar">
									<span class="component-title">
										Searchbar
									</span>
									<span class="component-desc">
										搜索功能.
									</span>
								</label>
							</div>
							
						</div>
					</div>
					
					<div class="ui-widget ui-widget-content component-group clearfix">
						<div class="component-group-desc">
							<h3>
								Sundry
							</h3>
						</div>
						<div class="component-group-list">
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core,sundry" class="ui-widget-content" name="sundry-anchor" id="anchor" checked="checked"/>
								<label class="clearfix" title="" for="anchor">
									<span class="component-title">
										anchor
									</span>
									<span class="component-desc">
										文字链接模块
									</span>
								</label>
							</div>
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core,sundry,searchbar" class="ui-widget-content" name="sundry-action" id="action" checked="checked"/>
								<label class="clearfix" title="" for="action">
									<span class="component-title">
										action
									</span>
									<span class="component-desc">
										按扭链接模块
									</span>
								</label>
							</div>
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core,sundry" class="ui-widget-content" name="sundry-extend" id="extend" checked="checked"/>
								<label class="clearfix" title="" for="extend">
									<span class="component-title">
										extend
									</span>
									<span class="component-desc">
										自定义扩展模块
									</span>
								</label>
							</div>
						</div>
					</div>
					
					
					<div class="ui-widget ui-widget-content component-group clearfix">
						<div class="component-group-desc">
							<h3>
								Beacon
							</h3>
						</div>
						<div class="component-group-list">
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core,beacon" class="ui-widget-content" name="beacon-user" id="user" checked="checked"/>
								<label class="clearfix" title="" for="user">
									<span class="component-title">
										user
									</span>
									<span class="component-desc">
										用户信息模块
									</span>
								</label>
							</div>
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core,beacon" class="ui-widget-content" name="beacon-nav" id="nav" checked="checked"/>
								<label class="clearfix" title="" for="nav">
									<span class="component-title">
										nav
									</span>
									<span class="component-desc">
										灯塔导航模块
									</span>
								</label>
							</div>
						</div>
					</div>
					
					
					<div class="ui-widget ui-widget-content component-group clearfix">
						<div class="component-group-desc">
							<h3>
								Searchbar
							</h3>
						</div>
						<div class="component-group-list">
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core,searchbar" class="ui-widget-content" name="searchbar-advanced" id="advanced" checked="checked"/>
								<label class="clearfix" title="" for="advanced">
									<span class="component-title">
										advanced
									</span>
									<span class="component-desc">
										高级搜索
									</span>
								</label>
							</div>
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core,searchbar" class="ui-widget-content" name="searchbar-type" id="type" checked="checked"/>
								<label class="clearfix" title="" for="type">
									<span class="component-title">
										type
									</span>
									<span class="component-desc">
										搜索类型选择，默认提供Product、Supplier、Buyer三种搜索类型的切换。
									</span>
								</label>
							</div>
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core,searchbar" class="ui-widget-content" name="searchbar-related" id="related" checked="checked"/>
								<label class="clearfix" title="" for="related">
									<span class="component-title">
										related
									</span>
									<span class="component-desc">
										相关关键词推荐
									</span>
								</label>
							</div>
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core,searchbar" class="ui-widget-content" name="searchbar-static" id="static" checked="checked"/>
								<label class="clearfix" title="" for="static">
									<span class="component-title">
										static
									</span>
									<span class="component-desc">
										静态关键词推荐、历史搜索
									</span>
								</label>
							</div>
							<div class="clearfix">
								<input type="checkbox" data-dependencies="core,searchbar" class="ui-widget-content" name="searchbar-dynamic" id="dynamic" checked="checked"/>
								<label class="clearfix" title="" for="dynamic">
									<span class="component-title">
										dynamic
									</span>
									<span class="component-desc">
										动态关键词匹配（自动完成）
									</span>
								</label>
							</div>
						</div>
				</div>
				<div class="download-builder-header">
					<h2>
						Custom 
					</h2>
					<div class="theme-area">
						<p class="component-title">
							根据你的需求自定义配置
						</p>
						<div class="field-pair">
						</div>
						<div class="field-pair advanced-settings">
							<label for="searchbar-placeholder">
								placeholder(搜索框提示， 默认值：Please input a keyword ):
							</label>
							<input type="text" data-dependencies="core,searchbar" name="searchbar.placeholder" value="" id="searchbar-placeholder" />
							
							<label for="searchbar-currentKeyword">
								当前搜索关键字:
							</label>
							<input type="text" data-dependencies="core,searchbar" name="searchbar.keyword" value="" id="searchbar-currentKeyword" />
							
							
							<label for="searchbar-currentType">
								当前搜索类型(默认值：searchbar type的第一个):
							</label>
							<input type="text" data-dependencies="core,searchbar,type" name="searchbar.currentType" value="" id="searchbar-currentType" />
							
							
							<label for="initComplete-searchbar-setFormAction">
								设置表单提交地址:
							</label>
							<input type="text" data-dependencies="core,searchbar" name="initComplete.searchbar.setFormAction" value="" id="initComplete-searchbar-setFormAction"/>
							
							
							<label for="searchbar-data">
								设置搜索类型:
							</label>
							<textarea type="text" data-dependencies="core,searchbar,type" name="searchbar.data" value="" id="searchbar-data" ></textarea>
							
							
							
							<label for="searchbar-currentKeyword">
								推荐词个性化推荐，限定在某个分类ID:
							</label>
							<input type="text" data-dependencies="core,searchbar,dynamic" name="searchbar.autoSuggestionCateId" value="" id="searchbar-autoSuggestionCateId" />
							
							
							<label for="searchbar-aisnServer">
								aisn server URL(默认值：http://www.alibaba.com):
							</label>
							<input type="text" data-dependencies="core,searchbar" name="searchbar.aisnServer" value="" id="searchbar-aisnServer" />
							
							
						</div>
					</div>
				</div>
				<input type="submit" value="Builde" class="ui-button" />
				<input type="button" class="ui-button btn-cms-code" value="CMS代码" />
				<input type="button" class="ui-button btn-vm-code" value="VM代码" /> 
			</form>
		</div>
	</div>
	</div>
	<script src="jquery.min.js"></script>
	<script src="jquery-ui-1.9.2.custom.js"></script>
	<script src="jquery.form.js"></script>
	<script src="download.js"></script>
    <script src="javascript/object2string.js"></script>
	<script>
		$(function() {
			$( ".ui-button" ).button();
		});
	
		// wait for the DOM to be loaded 
		(function($) {
			var form = $('#download-form'),
				formArray = Array;
			form.submit(builde);
			
			if ($.browser.msie) {
				$('input:radio').click(function () {
					this.blur();
					this.focus();
				});
			}
			
			$("#ischange").change(function() {
			     
			}); 
			
			$('.btn-builde').on('click',function(){
				builde(true);
			});
			$('.btn-cms-code').on('click',function(){
				builde(false);
				alert('cms');
			});
			$('.btn-vm-code').on('click',function(){
				builde(false);
				alert('vm');
			});
			
			'component-group'
			
			function builde( reload ){
				headerConfig = {};
				formArray = form.formToArray();
				layout = getFiledByName('layout').value;
				if (getFiledByName('core').value !== 'on') {
					alert('empty');
				} else {
					buiderConfig();
				}
				console.log(layout);
				//console.log(JSON.stringify(headerConfig, null, '\t'));
				//window.open(document.all.ifrmname.src,'header-view-iframe','')
				if( reload == null ||reload == true ){
					getIframeDocument(frames['header-view-iframe']).location.reload();
				}
				return false;
			}
			function getFiledByName(name){
				var resval = null;
				formArray.forEach(function(item,index){
					if( item.name === name ){
						resval = item;
					}
				});
				return resval;
			}
			function getIframeDocument(element) {  
				return  element.contentDocument || element.contentWindow.document;  
			};  
			function getGroupFields(name) {
				var arr = $.grep(formArray,
					function(item, i) {
						return (item.value === 'on' && item.name.indexOf(name) > -1);
					});
				return arr; //arr.length === 0 ? null : arr;
			}
			function getGroupFieldObject(groupFields, keys) {
				var newArr = [],
					newGroupFields = $.map(groupFields,
						function(item, i) {
							item.data = (i > 0 ? item.name.replace(keys[0] + '-', '') : item.name);
							return item;
						}),
					arr = $.grep(newGroupFields,
						function(item, i) {
							return keys.indexOf(item.data) > -1;
						}),
					son = [];
				arr.forEach(function(item, i) {
					newArr.push(item);
					if (i > 0) {
						son.push(item.data);
					}
				});

				return {
					all: newArr,
					son: son,
					count: newArr.length
				};
			}
			function getCustemFileds(){
				var arr = $.grep(formArray,
					function(item, i) {
						//排除initComplete
						return (item.type ==="text" && item.name.indexOf('initComplete') < 0);
					});
				return arr;
			}
			function buiderConfig() {
				addModConfig(['sundry', 'anchor', 'action', 'extend']);
				addModConfig(['beacon', 'user', 'nav']);
				addModConfig(['searchbar', 'type', 'static', 'dynamic', 'advanced', 'related']);
				
				addCustemConfig();
				/*addConfig( 'initComplete', function(beacon, sundry, searchbar){
						sundry.extend.html('<h2>Extend</h2>');
						searchbar.addField('key0', 'val0');
					}.toString());*/
			}
			function addCustemConfig( ){
				var fieldArray = getCustemFileds(),
					val = '';
				fieldArray.forEach(function( item, index){
					val = item.value;
					if( val !== ''){
						addConfig(item.name,val);
					}
				});
			}
			function addModConfig(keys) {
				var groupName = keys[0],
				fields = getGroupFields(groupName),
				data = getGroupFieldObject(fields, keys);
				if (data.count === 0) {
                    addConfig('mod.' + groupName, null);
                } else if (data.count === 1) {
					addConfig('mod.' + groupName, []);
				} else if (data.count > 1 && (keys.length - 1 !== data.son.length)) {
					addConfig('mod.' + groupName, data.son);
				}
			}
			function addConfig(path, value) {
				var p = path.split('.'),
				count = p.length,
				o = headerConfig,
				item;
				for (var i = 0; i < count - 1; i++) {
					item = p[i];
					if (!o.hasOwnProperty(item)) {
						o[p[i]] = {};
						o = o[p[i]];
					} else {
						o = o[p[i]];
					}
				}
				o[p[i]] = value;
			}
		})(jQuery);
	</script>
</body>

</html>