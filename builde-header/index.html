<!DOCTYPE html>
<!--[if IE 7 ]>		 <html class="no-js ie ie7 lte7 lte8 lte9" lang="en-US"> <![endif]-->
<!--[if IE 8 ]>		 <html class="no-js ie ie8 lte8 lte9" lang="en-US"> <![endif]-->
<!--[if IE 9 ]>		 <html class="no-js ie ie9 lte9>" lang="en-US"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html class="no-js" lang="en-US">
    <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Download Builder | jQuery UI</title>
        <meta name="author" content="The jQuery Project - jQuery.org">
        <meta name="description" content="jQuery: The Write Less, Do More, JavaScript Library">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
        <link rel="pingback" href="http://jqueryui.com/xmlrpc.php" />
		
        <link rel="stylesheet" href="jquery-ui.css">
        <link rel="stylesheet" href="download.css">
		<script>
			var headerConfig = null;
		</script>
    </head>
    <body class="jquery-ui page page-id-69 page-parent page-template page-template-nosidebar-page-php page-slug-download single-author singular">
		<div id="header-view">
			<div style="width:990px; margin:0 auto;border-bottom:1px solid #ddd; height:120px;">
				<iframe src="header.html" id="header-view-iframe" frameborder="no" width="100%" marginheight="0" marginwidth="0"></iframe>
			</div>
		</div>
        <div id="download-builder" data-download-jqueryui-host="http://download.jqueryui.com">
            <form action="http://download.jqueryui.com/download" method="POST" id="download-form">
                <div class="download-builder-header">
                    <h2>Version</h2>
                    <p class="component-title">
                        1.0
                    </p>
                </div>
                <div class="download-builder-header">
                    <h2>Components</h2>
                </div>
                <div class="components">
                    <div class="ui-widget ui-widget-content component-group-other clearfix">
                        <div class="component-group-desc">
                            <h3>版式</h3>
                        </div>
                        <div class="component-group-list-other">
                            <label title="版式" class="clearfix">
                                <input type="radio" name="layout" value="full" class="ui-widget-content" data-dependencies="">
                                <span class="component-title">full</span> <span class="component-desc">类似首页（搜索功能样式的差异）</span> </label>
                            <label title="normal" class="clearfix">
                                <input type="radio" checked="checked" name="layout" value="normal" class="ui-widget-content" data-dependencies="core">
                                <span class="component-title">normal（推荐使用）</span> <span class="component-desc">类似频道页面</span> </label>
                        </div>
                    </div>
					
					
				
                    <div class="ui-widget ui-widget-content component-group clearfix">
                        <div class="component-group-desc">
                            <h3>Core</h3>
                            <p>
                            </p>
                        </div>
                        <div class="component-group-list">
                            <label title="Header核心" class="clearfix">
                                <input type="checkbox" checked name="core" class="ui-widget-content" data-dependencies="">
                                <span class="component-title">Core</span> <span class="component-desc">Header核心</span> </label>
                            <label title="Sundry" class="clearfix">
                                <input type="checkbox" checked name="sundry" class="ui-widget-content" data-dependencies="core">
                                <span class="component-title">Sundry</span> <span class="component-desc">Header杂项功能</span> </label>
                            <label title="激活灯塔模块" class="clearfix">
                                <input type="checkbox" checked name="beacon" class="ui-widget-content" data-dependencies="core">
                                <span class="component-title">Beacon</span> <span class="component-desc">灯塔功能</span> </label>
                            <label title="激活搜索模块" class="clearfix">
                                <input type="checkbox" checked name="searchbar" class="ui-widget-content" data-dependencies="core">
                                <span class="component-title">Searchar</span> <span class="component-desc">搜索功能</span> </label>
                        </div>
                    </div>
                    <div class="ui-widget ui-widget-content component-group clearfix">
                        <div class="component-group-desc">
                            <h3>Sundry功能</h3>
                        </div>
                        <div class="component-group-list">
                            <label title="激活该功能。" class="clearfix">
                                <input type="checkbox" checked name="sundry-anchor" class="ui-widget-content" data-dependencies="core,sundry">
                                <span class="component-title">anchor</span> <span class="component-desc">文字链接模块</span> </label>
                            <label title="激活该功能。" class="clearfix">
                                <input type="checkbox" checked name="sundry-action" class="ui-widget-content" data-dependencies="core,sundry,searchbar">
                                <span class="component-title">action</span> <span class="component-desc">按扭链接模块</span> </label>
                            <label title="激活该功能。" class="clearfix">
                                <input type="checkbox" checked name="sundry-extend" class="ui-widget-content" data-dependencies="core,sundry">
                                <span class="component-title">extend</span> <span class="component-desc">自定义扩展模块</span> </label>
                        </div>
                    </div>
                    <div class="ui-widget ui-widget-content component-group clearfix">
                        <div class="component-group-desc">
                            <h3>Beacon功能</h3>
                        </div>
                        <div class="component-group-list">
                            <label title="激活该功能。" class="clearfix">
                                <input type="checkbox" checked name="beacon-user" class="ui-widget-content" data-dependencies="core,beacon">
                                <span class="component-title">user</span> <span class="component-desc">用户信息模块</span> </label>
                            <label title="激活该功能。" class="clearfix">
                                <input type="checkbox" checked name="beacon-nav" class="ui-widget-content" data-dependencies="core,beacon">
                                <span class="component-title">nav</span> <span class="component-desc">灯塔导航模块</span> </label>
                        </div>
                    </div>
                    <div class="ui-widget ui-widget-content component-group clearfix">
                        <div class="component-group-desc">
                            <h3>Searchbar功能</h3>
                        </div>
                        <div class="component-group-list">
                            <label title="激活该功能。" class="clearfix">
                                <input type="checkbox" checked name="searchbar-advanced" class="ui-widget-content" data-dependencies="core,searchbar">
                                <span class="component-title">advanced</span> <span class="component-desc">高级搜索</span> </label>
                            <label title="激活该功能，默认提供Product、Supplier、Buyer三种搜索类型的切换。" class="clearfix">
                                <input type="checkbox" checked name="searchbar-type" class="ui-widget-content" data-dependencies="core,searchbar">
                                <span class="component-title">type</span> <span class="component-desc">搜索类型选择，默认提供Product、Supplier、Buyer三种搜索类型的切换。</span> </label>
                            <label title="激活该功能。" class="clearfix">
                                <input type="checkbox" checked name="searchbar-static" class="ui-widget-content" data-dependencies="core,searchbar">
                                <span class="component-title">static</span> <span class="component-desc">静态关键词推荐、历史搜索</span> </label>
							<label title="激活该功能。" class="clearfix">
                                <input type="checkbox" checked name="searchbar-dynamic" class="ui-widget-content" data-dependencies="core,searchbar">
                                <span class="component-title">dynamic</span> <span class="component-desc">动态关键词匹配</span> </label>
							<label title="激活该功能。" class="clearfix">
                                <input type="checkbox" checked name="searchbar-related" class="ui-widget-content" data-dependencies="core,searchbar">
                                <span class="component-title">related</span> <span class="component-desc">相关关键词推荐</span> </label>
                        </div>
                    </div>
					
					
					<div class="ui-widget ui-widget-content component-group-other clearfix">
                        <div class="component-group-desc">
                            <h3>自定义参数</h3>
                        </div>
                        <div class="component-group-list-other">
                            <table>
								<tr>
									<td>
										<label title="激活该功能。" class="clearfix">
											<input type="checkbox" class="ui-widget-content" data-dependencies="core,searchbar" />
										</label>
										<input type="text" value="Please inpt a keyword!"/>
									</td>
									<td></td>
									<td></td>
								</tr>
							</table>
                        </div>
                    </div>
					
                </div>
                <input type="submit" class="ui-widget-content" value="Submit">
            </form>
        </div>
        <script src="jquery.min.js"></script>
        <script src="jquery-ui.min.js"></script>
		<script src="jquery.form.js"></script> 
        <script src="download.js"></script>
 
		<script> 
			// wait for the DOM to be loaded 
			(function($){
				var form = $('#download-form'),
					formArray = Array;
				form.submit(function() {
					headerConfig = {};
					formArray = form.formToArray();
					if( formArray.length === 0 ){
						alert('empty');
					}else{
						buiderConfig();
					}
					//console.log( JSON.stringify(headerConfig, null, '\t') );
					$('#header-view-iframe').src = $('#header-view-iframe').src;
					return false;
				});
				function getGroupFields ( name ){
					var arr = $.grep(formArray, function(item, i){
						return ( item.value === 'on' && item.name.indexOf( name ) > -1 );
					});
					return arr;//arr.length === 0 ? null : arr;
				}
				function getGroupFieldObject( groupFields, keys ){
					var newArr = [],
						newGroupFields = $.map( groupFields, function(item, i){
							item.data = (i > 0 ? item.name.replace(keys[0]+'-',''):item.name);
							return item;
						})
						arr = $.grep( newGroupFields, function(item, i){
							return keys.indexOf( item.data ) > -1;
						}),
						son = [];
					arr.forEach( function( item, i ){
						newArr.push( item );
						if( i > 0 ){
							son.push(item.data);
						}
					});
					
					return {
						all : newArr,
						son : son,
						count : newArr.length
					};
				}
				function buiderConfig(){
					addModConfig(['sundry','anchor','action','extend']);
					addModConfig(['beacon','user','nav']);
					addModConfig(['searchbar','type','static','dynamic','advanced','related']);
					
					/*addConfig( 'initComplete', function(beacon, sundry, searchbar){
						sundry.extend.html('<h2>Extend</h2>');
						searchbar.addField('key0', 'val0');
					}.toString());*/
				}
				function addModConfig( keys ){
					var groupName = keys[0],
						fields = getGroupFields( groupName ),
						data = getGroupFieldObject( fields, keys );
					if( data.count === 1 ){
						addConfig( 'mod.'+groupName, [] );
					}else if( data.count > 1 && (keys.length - 1 !== data.son.length)  ){
						addConfig( 'mod.'+groupName, data.son );
					}
				}
				function addConfig( path , value ){
					var p = path.split('.'),
						count = p.length,
						o = headerConfig,
						item;
					for( var i = 0; i < count-1; i++){
						item = p[i];
						if( !o.hasOwnProperty(item) ){
							o[p[i]] = {};
							o = o[p[i]];
						}else{
							o = o[p[i]];
						}
					}
					o[p[i]] = value;
				}
			})(jQuery); 
		</script> 
    </body>
</html>